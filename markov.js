const names = {
    "alethi": {
        "male":[
            "Abry",
            "Acis",
            "Adolin",
            "Agil",
            "Alabet",
            "Aladar",
            "Alds",
            "Arafik",
            "Aratin",
            "Avarak",
            "Avaran",
            "Bashin",
            "Beard",
            "Beld",
            "Bethab",
            "Bordin",
            "Caull",
            "Cenn",
            "Colot",
            "Dalar",
            "Dalinar",
            "Dallet",
            "Deedanor",
            "Dod",
            "Dru",
            "Dunny",
            "Elhokar",
            "Elit",
            "Febin",
            "Febin",
            "Galan",
            "Gallam",
            "Gavilar",
            "Graves",
            "Habrin",
            "Halad",
            "Halam",
            "Hallaw",
            "Hamadin",
            "Harl",
            "Harth",
            "Hatham",
            "Hathan",
            "Hav",
            "Havar",
            "Havarah",
            "Havrom",
            "Hid",
            "Idrin",
            "Ilamar",
            "Isasik",
            "Jakamav",
            "Jam",
            "Jest",
            "Jor",
            "Jorna",
            "Jost",
            "Kadash",
            "Kaladin",
            "Kalanor",
            "Kalishnor",
            "Kelerand",
            "Khav",
            "Khem",
            "Lamaril",
            "Lanacin",
            "Lirin",
            "Loats",
            "Loradar",
            "Lustow",
            "Mabrow",
            "Malan",
            "Marf",
            "Marks",
            "Matain",
            "Matal",
            "Meleran",
            "Meridas",
            "Milp",
            "Moash",
            "Mord",
            "Nacomb",
            "Naget",
            "Natam",
            "Natir",
            "Niter",
            "Noromin",
            "Oroden",
            "Paladar",
            "Perethom",
            "Ral",
            "Ralinor",
            "Rembrinor",
            "Renarin",
            "Resi",
            "Rial",
            "Rillir",
            "Rind",
            "Roion",
            "Sadeas",
            "Sadees",
            "Salinor",
            "Serugiadis",
            "Saday",
            "Sheler",
            "Shim",
            "Sidin",
            "Taka",
            "Talanor",
            "Taleb",
            "Tanalan",
            "Taselin",
            "Tearim",
            "Teft",
            "Teleb",
            "Thakka",
            "Thanadal",
            "Tibon",
            "Tien",
            "Tinalar",
            "Ton",
            "Torol",
            "Tukks",
            "Turinad",
            "Urimil",
            "Vaceslv",
            "Valama",
            "Vardinar",
            "Vartian",
            "Vedekar",
            "Velalant",
            "Ven",
            "Vevidar",
            "Wistiow",
            "Yenev",
            "Yezriar"
        ],
        "female": [
            "Aesudan",
            "Alami",
            "Chanada",
            "Danlan",
            "Eshava",
            "Hamaradin",
            "Hashal",
            "Hesina",
            "Ialai",
            "Inadara",
            "Inkima",
            "Ishal",
            "Ishnah",
            "Istow",
            "Ithi",
            "Ivis",
            "Janala",
            "Jasalai",
            "Jasnah",
            "Jayla",
            "Jenet",
            "Jevena",
            "Kusiri",
            "Lalai",
            "Laral",
            "Litima",
            "Lyn",
            "Mara",
            "Miasal",
            "Muri",
            "Nall",
            "Nananav",
            "Navani",
            "Relinar",
            "Ristina",
            "Rushu",
            "Sani",
            "Seland",
            "Tarah",
            "Terith",
            "Teshav",
            "Velat"
        ],
        "surname": [
            "Amaram",
            "Eved",
            "Gaval",
            "Khal",
            "Kholin",
            "Marakal",
            "Morakotha",
            "Perel",
            "Roshone",
            "Ruthar",
            "Sebarial",
            "Shulin",
            "Vamah"
        ]
    },
    "singers": {
        "male": [
            "Abranay",
            "Abronai",
            "Aharat",
            "Altoki",
            "Bru",
            "Davim",
            "Demid",
            "Devi",
            "Gitgeth",
            "Jali",
            "Klade",
            "Kyril",
            "Mrun",
            "Nam",
            "Rine",
            "Sah",
            "Thude",
            "Ton",
            "Turash",
            "Varanis"
        ],
        "female": [
            "Bila",
            "Brianlia",
            "Chivi",
            "Eshonai",
            "Gangnah",
            "Hariel",
            "Hesh",
            "Hnanan",
            "Khen",
            "Leshwi",
            "Melu",
            "Pal",
            "Rlain",
            "Vai",
            "Varnali",
            "Vatwha",
            "Venli",
            "Vldgen",
            "Zuln"
        ]
    },
    "veden": {
        "male": [
            "Abrial",
            "Amark",
            "Balat",
            "Beal",
            "Boriar",
            "Ekel",
            "Evinor",
            "Geved",
            "Gevelmar",
            "Hanavanar",
            "Helaran",
            "Jal",
            "Jix",
            "Jushu",
            "Lin",
            "Luesh",
            "Mill",
            "Nalanar",
            "NanHar",
            "NanKhet",
            "Redin",
            "Ren",
            "Revilar",
            "Rin",
            "Sur",
            "Talak",
            "Ten",
            "Ton",
            "Urian",
            "Urv",
            "Wikim"
        ],
        "female": [
            "Eylita",
            "Hasheh",
            "Malata",
            "Malise",
            "Mem",
            "Natata Ved",
            "Shallan",
            "Sudi"
        ],
        "surname": [
            "Davar",
            "Tavinar",
            "Valam",
            "Kamar"
        ]
    },
    "thaylen": {
        "male": [
            "Artmyrn",
            "Barmest",
            "Beznk",
            "Estnatil",
            "Febrth",
            "Fladm",
            "Hrdalm",
            "Jochi",
            "Kdralk",
            "Kmakl",
            "Mraize",
            "Mrall",
            "Tlik",
            "Tozbek",
            "Tshadr",
            "Tvlakv",
            "Vazrmeb",
            "Vstim",
            "Wzmal",
            "Yalb",
            "Yokska"
        ],
        "female": [
            "Ashlv",
            "Devmrh",
            "Fen",
            "Kmakra",
            "Rysn"
        ]
    },
    "glyph": [
        "jeseh",
        "nan",
        "chach",
        "vev",
        "palah",
        "shash",
        "beteb",
        "kak",
        "tanat",
        "ishi",
        "abara",
        "adoda",
        "amaya",
        "bakhash",
        "gesheh",
        "idi",
        "javani",
        "kadulek",
        "kalak",
        "katef",
        "kecheh",
        "khakh",
        "khohk",
        "markhazh",
        "laial",
        "lerel",
        "linil",
        "mehlak",
        "merem",
        "mevizh",
        "morom",
        "nahn",
        "parap",
        "sas",
        "sebes",
        "shash",
        "shenesh",
        "tafar",
        "tebel",
        "thath",
        "tsameth",
        "zatalef",
        "zeras"
    ]
};

document.addEventListener('DOMContentLoaded', function() {
    // Create corpus
    for(const key of Object.keys(names)) {
        console.log(key)
    }
}, false);

function generate_corpus(names) {
    let corpus = [];

    names.forEach((el, ar) => {
        el += '\n';
        corpus.push.apply(corpus, el.split(''));
    });

    return corpus;
}

function generate_chain(corpus) {
    let chain = {};
    let n_names = corpus.length;

    corpus.forEach((key1, i) => {
        let key2 = '';
        let letter = '';
        if (n_names > i + 2) {
            key2 = corpus[i + 1];
            letter = corpus[i + 2];
        }

        let key = key1 + key2;
        if (!chain[key]) {
            chain[key] = [letter];
        } else {
            chain[key].push(letter)
        }
    });

    return chain;
}

function markov(corpus, chain) {
    let nkey = '  ';
    while(
        nkey.charAt(0) === ' ' ||
        nkey.charAt(0) === nkey.charAt(0).toLowerCase() ||
        nkey.charAt(0) === '\n' ||
        !chain[nkey]
    ) {
        let key1 = corpus[Math.floor(Math.random() * corpus.length)];
        let key2 = corpus[Math.floor(Math.random() * corpus.length)];
        nkey = key1 + key2;
    }

    let l = '';
    let name = nkey;
    while (l !== '\n') {
        l = chain[nkey][Math.floor(Math.random() * chain[nkey].length)];
        name += l;
        nkey = nkey.charAt(1) + l;
    }

    // Take off carriage return
    return name.slice(0, -1);

}
var serialize = function (form) {
	// Setup our serialized data
	var serialized = {};

	// Loop through each field in the form
	for (var i = 0; i < form.elements.length; i++) {
		var field = form.elements[i];
		// Don't serialize fields without a name, submits, buttons, file and reset inputs, and disabled fields
		if (!field.name || field.disabled || field.type === 'file' || field.type === 'reset' || field.type === 'submit' || field.type === 'button') continue;

		// If a multi-select, get all selections
		if (field.type === 'select-multiple') {
			for (var n = 0; n < field.options.length; n++) {
				if (!field.options[n].selected) continue;
				serialized[encodeURIComponent(field.name)] = encodeURIComponent(field.options[n].value);
			}
		}

		// Convert field data to a query string
		else if ((field.type !== 'checkbox' && field.type !== 'radio') || field.checked) {
			serialized[encodeURIComponent(field.name)] = encodeURIComponent(field.value);
		}
	}

	return serialized;
};

function generate() {
    let form = document.querySelector('form');

    let options = serialize(form);

    let name_list = [];

    if (options.gender === "both") {
        name_list = name_list.concat(names[options.ethnic]['male'], names[options.ethnic]['female']);
    } else {
        name_list = name_list.concat(names[options.ethnic][options.gender]);
    }

    if ((options.ethnic === "alethi" || options.ethnic === "veden") && options.glyph === "true") {
        name_list = name_list.concat(names['glyph']);
    }

    console.log(name_list);

    let corpus = generate_corpus(name_list);
    let chain = generate_chain(corpus);
    let name = markov(corpus, chain);

    document.getElementById("result").innerHTML = name;
    if (name_list.includes(name)) {
        console.log("Hey this is in the book!");
    }
}